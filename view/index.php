<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The best app</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/clock.css">
    <link rel="stylesheet" href="../css/convert.css">
    <link rel="stylesheet" href="../css/todolist.css">
</head>
<body>
<div class="clock">
    <table class="hour">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="hour">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="doter">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="minute">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="minute">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="doter">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="second">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
    <table class="second">
        <tr>
            <td class="a"></td>
            <td class="b"></td>
            <td class="c"></td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="doter"></td>
            <td class="e"></td>
        </tr>
        <tr>
            <td class="f"></td>
            <td class="g"></td>
            <td class="i"></td>
        </tr>
        <tr>
            <td class="j"></td>
            <td class="doter"></td>
            <td class="k"></td>
        </tr>
        <tr>
            <td class="l"></td>
            <td class="m"></td>
            <td class="n"></td>
        </tr>
    </table>
</div>

<div class="convert">
    <input type="date" id="cur_date" value="2022-02-02">
    <div class="convert_block_item">
        <input type="number" id="val" placeholder=""/>
        <select id="cur1">
            <option>RUB</option>
            <option>USD</option>
            <option>EUR</option>
        </select>
    </div>
    <div class="coefficient">1 <span id="left">RUB</span> = <span id="coef">1.00</span> <span id="right">RUB</span>
    </div>
    <div class="convert_block_item">
        <input type="number" id="val2" placeholder=""/>
        <select id="cur2">
            <option>RUB</option>
            <option>USD</option>
            <option>EUR</option>
        </select>
    </div>
</div>

<div class="line" style="height: 5px; background: #000; margin: 10px 0"></div>

<div class="list">
    <div class="lina">
        <input type="text" id="text" name="text" disabled>
        <input type="button" id="add" name="add" value="+">
    </div>
    <div class="list conteiner">
        <span>Список пока пуст</span>
        <ul id="lina" class="conteiner"></ul>
    </div>

</div>

<script>
    function colorTop(i = 1) {
        document.getElementsByClassName("a")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("b")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("c")[i - 1].style = "background-color: #000;";
    }

    function colorMiddle(i = 1) {
        document.getElementsByClassName("f")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("g")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("i")[i - 1].style = "background-color: #000;";
    }

    function colorBottom(i = 1) {
        document.getElementsByClassName("l")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("m")[i - 1].style = "background-color: #000;";
        document.getElementsByClassName("n")[i - 1].style = "background-color: #000;";
    }

    function colorElements(n, i = 1) {
        document.getElementsByClassName("a")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("b")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("d")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("e")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("f")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("g")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("i")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("j")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("k")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("n")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("l")[i - 1].style = "background-color: #fff;";
        document.getElementsByClassName("m")[i - 1].style = "background-color: #fff;";

        switch (n) {
            case 1:
                document.getElementsByClassName("c")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("i")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("n")[i - 1].style = "background-color: #000;";
                break;
            case 2:
                colorTop(i);
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                document.getElementsByClassName("j")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 3:
                colorTop(i);
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 4:
                document.getElementsByClassName("a")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("c")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("n")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                break;
            case 5:
                colorTop(i);
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 6:
                colorTop(i);
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                document.getElementsByClassName("j")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 7:
                colorTop(i);
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("i")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("n")[i - 1].style = "background-color: #000;";
                break;
            case 8:
                colorTop(i);
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("g")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("j")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 9:
                colorTop(i);
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                colorMiddle(i);
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;
            case 0:
                colorTop(i);
                document.getElementsByClassName("d")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("e")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("f")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("i")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("j")[i - 1].style = "background-color: #000;";
                document.getElementsByClassName("k")[i - 1].style = "background-color: #000;";
                colorBottom(i);
                break;

        }
    }

    function clock() {
        var date = new Date(),
            hours = date.getHours(),
            minutes = date.getMinutes(),
            seconds = date.getSeconds();
        colorElements(hours / 10 | 0, 1);
        colorElements(hours % 10, 2);

        colorElements(minutes / 10 | 0, 4);
        colorElements(minutes % 10, 5);

        colorElements(seconds / 10 | 0, 7);
        colorElements(seconds % 10, 8);
    }

    setInterval(clock, 1000);
    clock();

    let hookInterval = 1000;

    async function tgHook() {
        let url = '/site/tghook';
        await fetch(url);
    }

    setInterval(tgHook, hookInterval);
</script>
<script>
    window.onload = async function () {
        // var id = 0;
        var id = <?= SiteAjax::getMaxId() ? SiteAjax::getMaxId() + 1 : 0 ?>;
        // console.log(id);
        {
            let lina = document.getElementById('lina');
            let butAdd = document.getElementById('add');
            let text = document.getElementById('text');

            function getJson() {
                let xhr = new XMLHttpRequest();
                url = "/site/getAjax";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        let jsons = JSON.parse(this.responseText);
                        // alert(this.responseText);
                        for (x in jsons) {
                            let tmp = jsons[x];
                            addEvent(butAdd, tmp.id, tmp.message, tmp.status, tmp.datetime);

                        }
                    }
                };
                xhr.send();
            }

            await getJson();

            function setJson(ide, message, status, datetime) {
                let xhr = new XMLHttpRequest();
                url = "/site/addAjax";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        // alert(this.responseText);
                    }
                };
                var data = JSON.stringify(
                    {"id": ide, "message": message, "status": status, "datetime": datetime.toISOString()});
                xhr.send(data);
            }

            function updJson(ide, status) {
                let xhr = new XMLHttpRequest();
                url = "/site/updAjax";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        // alert(this.responseText);
                    }
                };
                var data = JSON.stringify(
                    {"id": ide, "status": status});
                xhr.send(data);
            }

            function delJson(ide) {
                let xhr = new XMLHttpRequest();
                url = "/site/delAjax";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        // alert(this.responseText);
                    }
                };
                var data = JSON.stringify(
                    {"id": ide});
                xhr.send(data);
            }

            function addEvent(wtf, ide = '', message = text.value, status = 0, datetime = new Date()) {
                if (message !== '') {
                    let liParent = document.createElement('li');
                    liParent.classList.add("row");
                    if (ide === '') {
                        setJson(id, message, status, datetime);
                    }
                    let icon = document.createElement('i');
                    icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-app" viewBox="0 0 16 16">\n' +
                        '  <path d="M11 2a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3h6zM5 1a4 4 0 0 0-4 4v6a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4V5a4 4 0 0 0-4-4H5z"/>\n' +
                        '</svg>';
                    let childId = document.createTextNode(' id: ' + (ide === '' ? id++ : ide));
                    let childIconId = document.createElement('div');
                    childIconId.classList.add("col-12", "col-sm-2", "col-md-2", "col-lg-1");
                    childIconId.appendChild(icon);
                    childIconId.appendChild(childId);
                    childIconId.addEventListener("click", updEvent);

                    let childMessage = document.createElement('div');
                    childMessage.classList.add("col-12", "col-sm-10", "col-md-10", "col-lg-7");
                    childMessage.innerHTML = "Message: " + message;

                    let childDate = document.createElement('div');
                    childDate.classList.add("col-12", "col-sm-6", "col-md-7", "col-lg-3");
                    childDate.innerHTML = "Create date: " + new Date(datetime).toLocaleString();

                    let childButDel = document.createElement('button');
                    childButDel.classList.add("col-12", "col-sm-6", "col-md-5", "col-lg-1", "rounded-3");
                    childButDel.innerHTML = "delete";
                    childButDel.addEventListener("click", delEvent);

                    liParent.appendChild(childIconId);
                    liParent.appendChild(childMessage);
                    liParent.appendChild(childDate);
                    liParent.appendChild(childButDel);
                    lina.appendChild(liParent);
                    text.value = '';

                    if (status == 1) {
                        let event = new Event("click");
                        childIconId.dispatchEvent(event);
                    }

                    listIsEmpty();
                }
            }

            function updEvent() {
                if (this.firstChild.firstChild.classList.contains('bi-app')) {
                    this.firstChild.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16">\n' +
                        '<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n' +
                        '<path d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"/>\n' +
                        '</svg>';
                    this.parentNode.childNodes[0].style.textDecoration = 'line-through';
                    this.parentNode.childNodes[1].style.textDecoration = 'line-through';
                    this.parentNode.childNodes[2].style.textDecoration = 'line-through';
                    updJson(('+' + this.parentNode.childNodes[0].innerText).slice(5), 1)
                } else {
                    this.firstChild.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-app" viewBox="0 0 16 16">\n' +
                        '<path d="M11 2a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3h6zM5 1a4 4 0 0 0-4 4v6a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4V5a4 4 0 0 0-4-4H5z"/>\n' +
                        '</svg>';
                    this.parentNode.childNodes[0].style.textDecoration = 'none';
                    this.parentNode.childNodes[1].style.textDecoration = 'none';
                    this.parentNode.childNodes[2].style.textDecoration = 'none';
                    updJson(('+' + this.parentNode.childNodes[0].innerText).slice(5), 0)
                }
            }

            function delEvent() {
                var tmp = '+' + this.parentNode.firstChild.innerText;
                // console.log(tmp.slice(5));
                delJson(tmp.slice(5));
                this.parentNode.parentNode.removeChild(this.parentNode);
                listIsEmpty();

            }

            butAdd.onclick = addEvent;

            function listIsEmpty() {
                if (lina.hasChildNodes()) {
                    lina.parentNode.firstElementChild.style.display = 'none';
                } else {
                    lina.parentNode.firstElementChild.style.display = 'block';
                }
            }
        }


        {
            let curDate = document.getElementById('cur_date');
            let val = document.getElementById('val');
            let result = document.getElementById('val2');
            let currency1 = document.getElementById('cur1');
            let currency2 = document.getElementById('cur2');
            let left = document.getElementById('left');
            let right = document.getElementById('right');
            let coef = document.getElementById('coef');

            var jsons;
            let tpmDate = new Date();
            curDate.value = tpmDate.toISOString().slice(0, 10);

            //date to form yyyy-mm-dd|

            async function getJsonDate() {
                let response;
                // let url = 'https://www.cbr-xml-daily.ru/daily_json.js';
                // response = await fetch(url);
                // jsons = await response.json();
                // let dalyDate = new Date(jsons.Date);
                let findDate = new Date(curDate.value + "T13:30:00+05:00");
                // console.log(dalyDate);
                // console.log(findDate);

                // if (findDate < dalyDate) {
                for (let i = 0; i < 10; i++) {
                    let month = (findDate.getMonth() < 9 ? '0' : '') + (findDate.getMonth() + 1);
                    let day = (findDate.getDate() < 10 ? '0' : '') + findDate.getDate();
                    url = 'https://www.cbr-xml-daily.ru/archive/' + findDate.getFullYear() + '/' + month + '/' + day + '/daily_json.js';
                    response = await
                        fetch(url, {mode: 'no-cors'});
                    if (response.ok) {
                        break;
                    }
                    console.log("Отсутствует доступ к " + url + " Статус запроса: " + response.status);
                    findDate.setSeconds(-24 * 60 * 60);
                }
                if (!response.ok) {
                    console.log("Используется https://www.cbr-xml-daily.ru/daily_json.js");
                    response = await
                        fetch('https://www.cbr-xml-daily.ru/daily_json.js');
                }
                jsons = await
                    response.json();
                // }

                // console.log(jsons);
            }

            function setRate() {
                for (let x in jsons.Valute) {
                    let op = document.createElement("option");
                    let child = document.createTextNode(x);
                    op.appendChild(child);
                    currency1.appendChild(op);
                    currency2.appendChild(op.cloneNode(true));
                    // jsons.Valute.x.Value - no work
                    rate[x] = jsons.Valute[x].Value;
                }
            }

            function calc(input = val, output = result, cur1 = currency1, cur2 = currency2) {
                output.value = "";
                var cf = rate[cur1.value] / rate[cur2.value];
                coef.innerHTML = cf.toFixed(3);
                output.value = input.value === "" ? "" : (input.value * cf).toFixed(2);
            }

            await getJsonDate();
            let rate = {RUB: 1};
            setRate();
            // console.log(rate);

            val.oninput = function () {
                calc();
            };

            result.oninput = function () {
                calc(result, val, currency2, currency1);
            };

            currency1.onchange = function () {
                left.innerHTML = currency1.value;
                calc();
            };

            currency2.onchange = function () {
                right.innerHTML = currency2.value;
                calc();
            };

            curDate.onchange = function () {
                getJsonDate();
                setRate();
                calc();
            }
        }
        text.disabled = false;
    }
</script>
</body>
</html>


<?php
